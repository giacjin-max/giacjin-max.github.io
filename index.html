<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Generatore Lista Cliccabile</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f7f7f7;color:#222;}
textarea{width:100%;height:120px;margin:6px 0;padding:8px;font-size:14px;}
button{padding:8px 12px;margin:4px 4px 8px 0;font-size:15px;border:none;border-radius:5px;cursor:pointer}
#gen{background:#007bff;color:white;}
#copy{background:#28a745;color:white;}
#preview{background:#fff;padding:12px;border:1px solid #ddd;margin-top:10px;}
#preview a{color:#007bff;text-decoration:none;} 
#preview a:hover{text-decoration:underline;}
h3,h4{margin:6px 0;}
div.item{margin-bottom:4px;}
</style>
</head>
<body>

<h2>üìò Generatore Lista Cinese / Italiano Cliccabile</h2>

<p><b>Titoli (uno per riga):</b></p>
<textarea id="titles" placeholder="Inserisci titoli qui..."></textarea>

<p><b>Link corrispondenti (uno per riga):</b></p>
<textarea id="links" placeholder="Inserisci link qui..."></textarea>

<p>
  <button id="gen">Genera Lista</button>
  <button id="copy">Copia Lista Cliccabile</button>
</p>

<div id="preview"></div>

<script>
let fullPinyinMap = {};

fetch('https://raw.githubusercontent.com/guoyunhe/pinyin-json/master/hanzi-no-tone-pinyin-table.json')
  .then(r => r.json())
  .then(data => { fullPinyinMap = data; })
  .catch(err => console.error("Errore caricamento pinyin.json:", err));

function isChinese(str){ return /[\u4e00-\u9fff]/.test(str); }
function fullPinyin(str){ return str.split('').map(c => fullPinyinMap[c] || c).join(''); }
function groupByInitial(list){
  const groups = {};
  list.forEach(item=>{
    const letter = item.pinyin[0].toUpperCase();
    if(!groups[letter]) groups[letter] = [];
    groups[letter].push(item);
  });
  return groups;
}

let latestHTML = "";

document.getElementById('gen').onclick = () => {
  const titles = document.getElementById('titles').value.trim().split(/\r?\n/).filter(Boolean);
  const links = document.getElementById('links').value.trim().split(/\r?\n/).filter(Boolean);
  if(titles.length !== links.length){ alert("‚ö†Ô∏è Titoli e link devono corrispondere!"); return; }

  const chinese = [], italian = [];
  titles.forEach((t,i)=>{
    const link = links[i];
    if(isChinese(t)) chinese.push({title: t, link: link, pinyin: fullPinyin(t).toLowerCase()});
    else italian.push({title: t, link: link, pinyin: t.toLowerCase()});
  });

  chinese.sort((a,b)=>a.pinyin.localeCompare(b.pinyin));
  italian.sort((a,b)=>a.pinyin.localeCompare(b.pinyin));

  function buildSection(list, sectionName){
    const grouped = groupByInitial(list);
    let html = `<h3>${sectionName}</h3>\n`;
    let counter = 1;
    Object.keys(grouped).sort().forEach(letter=>{
      html += `<h4>${letter}</h4>\n`;
      grouped[letter].forEach(item=>{
        html += `${counter}. <a href="${item.link}" target="_blank">${item.title}</a><br>\n`;
        counter++;
      });
    });
    return html;
  }

  latestHTML = buildSection(chinese, "CINESE") + buildSection(italian, "ITALIANO");
  document.getElementById('preview').innerHTML = latestHTML;
};

document.getElementById('copy').onclick = () => {
  if(!latestHTML){ alert("‚ö†Ô∏è Genera prima la lista!"); return; }

  // Creiamo un elemento temporaneo per copiare il testo formattato
  const temp = document.createElement("div");
  temp.innerHTML = latestHTML;
  document.body.appendChild(temp);

  const range = document.createRange();
  range.selectNodeContents(temp);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
  document.execCommand("copy");
  document.body.removeChild(temp);

  alert("‚úÖ Lista cliccabile copiata negli appunti!");
};
</script>
</body>
</html>
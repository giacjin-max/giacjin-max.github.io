<!doctype html>
<html lang="it"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Generatore Markdown - Ordinamento Pinyin</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:20px;background:#f7f7f7;color:#222;}
textarea{width:100%;height:120px;margin:6px 0;padding:8px;font-size:14px;}
button{padding:8px 12px;margin:4px 4px 8px 0;font-size:15px;border:none;border-radius:5px;cursor:pointer}
#gen{background:#007bff;color:white;} #copy{background:#28a745;color:white;}
#out{white-space:pre-wrap;background:#fff;padding:12px;border:1px solid #ddd;margin-top:10px}
#preview{margin-top:12px;background:#fff;padding:12px;border:1px solid #ddd;}
a{color:#007bff;text-decoration:none} a:hover{text-decoration:underline}
</style>
</head>
<body>
<h2>ðŸ“˜ Generatore Markdown (ordine pinyin corretto)</h2>

<p><b>Titoli (uno per riga):</b></p>
<textarea id="titles" placeholder="Inserisci titoli qui..."></textarea>

<p><b>Link corrispondenti (uno per riga):</b></p>
<textarea id="links" placeholder="Inserisci link qui..."></textarea>

<p>
  <button id="gen">Genera Markdown</button>
  <button id="copy">Copia Markdown</button>
</p>

<pre id="out"></pre>
<div id="preview"></div>

<script src="https://cdn.jsdelivr.net/npm/pinyin-pro/dist/pinyin-pro.min.js"></script>
<script>
function isChinese(str){ return /[\u4e00-\u9fff]/.test(str); }

document.getElementById('gen').onclick = () => {
  const titles = document.getElementById('titles').value.trim().split(/\r?\n/).filter(Boolean);
  const links = document.getElementById('links').value.trim().split(/\r?\n/).filter(Boolean);
  if (titles.length !== links.length){ alert("Il numero di titoli e link deve corrispondere!"); return; }

  const hasPinyin = typeof window.pinyinPro !== "undefined";
  const data = titles.map((t,i)=>({
    title: t,
    link: links[i],
    isChinese: isChinese(t),
    pinyin: hasPinyin ? window.pinyinPro.pinyin(t, {toneType:"none"}) : t
  }));

  // Ordinamento per pinyin completo o titolo
  data.sort((a,b)=>{
    if (a.isChinese && !b.isChinese) return -1;
    if (!a.isChinese && b.isChinese) return 1;
    const ka = a.isChinese ? a.pinyin.toLowerCase() : a.title.toLowerCase();
    const kb = b.isChinese ? b.pinyin.toLowerCase() : b.title.toLowerCase();
    return ka.localeCompare(kb);
  });

  let markdown = "";
  let currentLetter = "";
  let counter = 1;

  data.forEach(item=>{
    const letter = (item.isChinese ? item.pinyin[0] : item.title[0] || "").toUpperCase();
    if(letter && letter !== currentLetter){
      currentLetter = letter;
      markdown += `\n## ${currentLetter}\n`;
    }
    markdown += `${counter}. [${item.title}](${item.link})\n`;
    counter++;
  });

  document.getElementById('out').textContent = markdown.trim();

  // preview cliccabile
  let html = markdown
    .replace(/^## (.+)$/gm, "<h3>$1</h3>")
    .replace(/(\d+)\. \[(.+?)\]\((.+?)\)/g, '<div>$1. <a href="$3" target="_blank">$2</a></div>');
  document.getElementById('preview').innerHTML = html;
};

document.getElementById('copy').onclick = () => {
  const text = document.getElementById('out').textContent;
  navigator.clipboard.writeText(text).then(()=>alert("Markdown copiato!"));
};
</script>
</body>
</html>

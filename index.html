<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Generatore Markdown Cinese/Italiano</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f7f7f7;color:#222;}
textarea{width:100%;height:120px;margin:6px 0;padding:8px;font-size:14px;}
button{padding:8px 12px;margin:4px 4px 8px 0;font-size:15px;border:none;border-radius:5px;cursor:pointer}
#gen{background:#007bff;color:white;} #copy{background:#28a745;color:white;}
#out, #preview{white-space:pre-wrap;background:#fff;padding:12px;border:1px solid #ddd;margin-top:10px;}
#preview a{color:#007bff;text-decoration:none;} #preview a:hover{text-decoration:underline;}
</style>
</head>
<body>

<h2>ðŸ“˜ Generatore Markdown Cinese / Italiano</h2>

<p><b>Titoli (uno per riga):</b></p>
<textarea id="titles" placeholder="Inserisci titoli qui..."></textarea>

<p><b>Link corrispondenti (uno per riga):</b></p>
<textarea id="links" placeholder="Inserisci link qui..."></textarea>

<p>
  <button id="gen">Genera Markdown</button>
  <button id="copy">Copia Markdown</button>
</p>

<pre id="out"></pre>
<div id="preview"></div>

<script>
function isChinese(str){ return /[\u4e00-\u9fff]/.test(str); }

// Funzione semplice pinyin (aggiungi caratteri comuni se vuoi)
function simplePinyin(str){
  const map = {"ä½ ":"ni","å¥½":"hao","æˆ‘":"wo","çš„":"de"}; 
  return str.split('').map(c=>map[c]||c).join('');
}

document.getElementById('gen').onclick = () => {
  const titles = document.getElementById('titles').value.trim().split(/\r?\n/).filter(Boolean);
  const links = document.getElementById('links').value.trim().split(/\r?\n/).filter(Boolean);

  if(titles.length !== links.length){ alert("âš ï¸ Titoli e link devono corrispondere!"); return; }

  const chinese = [];
  const italian = [];

  // Separazione cinese / italiano con pinyin
  titles.forEach((t,i)=>{
    const link = links[i];
    if(isChinese(t)){
      chinese.push({title: t, link: link, pinyin: simplePinyin(t).toLowerCase()});
    } else {
      italian.push({title: t, link: link, pinyin: t.toLowerCase()});
    }
  });

  // Ordinamento
  chinese.sort((a,b)=>a.pinyin.localeCompare(b.pinyin));
  italian.sort((a,b)=>a.pinyin.localeCompare(b.pinyin));

  // Funzione per generare Markdown raggruppato per iniziale
  function generateSection(list){
    let markdown = "";
    let currentLetter = "";
    let counter = 1;
    list.forEach(item=>{
      const letter = item.pinyin[0].toUpperCase();
      if(letter && letter !== currentLetter){
        currentLetter = letter;
        markdown += `\n## ${currentLetter}\n`;
      }
      markdown += `${counter}. ${item.title} ${item.link}\n`;
      counter++;
    });
    return markdown;
  }

  // Genera Markdown completo
  let markdown = "### CINESE\n" + generateSection(chinese) + "\n\n### ITALIANO\n" + generateSection(italian);
  document.getElementById('out').textContent = markdown.trim();

  // Anteprima HTML
  let html = "<h3>CINESE</h3>";
  let counter = 1;
  chinese.forEach(item=>{
    html += `<div>${counter}. <a href="${item.link}" target="_blank">${item.title}</a></div>`;
    counter++;
  });
  html += "<h3>ITALIANO</h3>";
  counter = 1;
  italian.forEach(item=>{
    html += `<div>${counter}. <a href="${item.link}" target="_blank">${item.title}</a></div>`;
    counter++;
  });
  document.getElementById('preview').innerHTML = html;
};

document.getElementById('copy').onclick = () => {
  navigator.clipboard.writeText(document.getElementById('out').textContent)
    .then(()=>alert("âœ… Markdown copiato!"));
};
</script>
</body>
</html>